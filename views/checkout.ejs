<%- include('partials/header') %>

<div class="checkout-container">
  <h1>Checkout</h1>

  <% if (!session.cart || session.cart.totalQty === 0) { %>
    <div class="empty-cart">
      <p>Your cart is empty</p>
      <a href="/" class="btn btn-primary">Continue Shopping</a>
    </div>
  <% } else { %>
    <div class="checkout-content">
      <div class="checkout-form">
        <form action="/checkout" method="POST" id="checkoutForm">
          <div class="form-section">
            <h2>Shipping Information</h2>
            <div class="form-group">
              <label for="fullName">Full Name</label>
              <input type="text" id="fullName" name="fullName" required>
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
              <label for="address">Street Address</label>
              <input type="text" id="address" name="address" required>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="city">City</label>
                <input type="text" id="city" name="city" required>
              </div>
              <div class="form-group">
                <label for="state">State</label>
                <input type="text" id="state" name="state" required>
              </div>
              <div class="form-group">
                <label for="zipCode">ZIP Code</label>
                <input type="text" id="zipCode" name="zipCode" required>
              </div>
            </div>
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" name="phone" required>
            </div>
          </div>

          <div class="form-section">
            <h2>Payment Information</h2>
            <div class="form-group">
              <label for="cardNumber">Card Number</label>
              <input type="text" id="cardNumber" name="cardNumber" required pattern="[0-9]{16}" placeholder="1234 5678 9012 3456">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">Expiry Date</label>
                <input type="text" id="expiryDate" name="expiryDate" required pattern="(0[1-9]|1[0-2])\/[0-9]{2}" placeholder="MM/YY">
              </div>
              <div class="form-group">
                <label for="cvv">CVV</label>
                <input type="text" id="cvv" name="cvv" required pattern="[0-9]{3,4}" placeholder="123">
              </div>
            </div>
          </div>

          <div class="order-summary">
            <h2>Order Summary</h2>
            <% Object.entries(session.cart.items).forEach(([productId, item]) => { %>
              <div class="summary-item">
                <span class="item-name"><%= item.name %> Ã— <%= item.qty %></span>
                <span class="item-price">$<%= (item.price * item.qty).toFixed(2) %></span>
              </div>
            <% }); %>
            <div class="summary-row subtotal">
              <span>Subtotal</span>
              <span>$<%= session.cart.totalPrice.toFixed(2) %></span>
            </div>
            <div class="summary-row">
              <span>Shipping</span>
              <span>Free</span>
            </div>
            <div class="summary-row total">
              <span>Total</span>
              <span>$<%= session.cart.totalPrice.toFixed(2) %></span>
            </div>
          </div>

          <button type="submit" class="btn btn-primary place-order-btn">Place Order</button>
        </form>
      </div>
    </div>
  <% } %>
</div>

<%- include('partials/footer') %>